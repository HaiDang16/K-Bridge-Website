@using K_Bridge.Models
@{
    ViewData["Title"] = "Bài viết";
    <link href="/css/Newest.css" rel="stylesheet" />
    bool isCmtAvaiable = false;
}
<div class="row mb-5">
    <div class="d-flex justify-content-start fs-4">
        Làm sao để đổi mật khẩu email sinh viên sau khi đăng ký môn học đăng ký môn học?
    </div>
    <div class="d-flex justify-content-between align-items-center" style="border-bottom: 1px solid #493422">
        <div class="m-0 p-0 d-flex justify-content-between">
            <div class="py-2 me-2">0 Câu trả lời</div>
            <div class="py-2 ms-2">10 Lượt xem</div>
        </div>
        <div class="newest-card-tag px-5 mx-3 ">Tài liệu</div>
    </div>
    <div class="row m-0 p-0 mt-3 ">
        <div class="col-lg-1 flex-column">
            <button class="m-1">
                <img src="~/img/like.png" alt="Like" />
            </button>
           <p class="mt-2 fs-6 fw-bold text-color-logo">-123</p>
            <button class="m-1">
                <img src="~/img/un_like.png" alt="Like" />
            </button>
        </div>
        <div class="col-lg-11">
            <div>
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Non diam phasellus vestibulum lorem sed risus ultricies. Vitae proin sagittis nisl rhoncus mattis rhoncus urna neque viverra. Ut sem nulla pharetra diam sit. Curabitur vitae nunc sed velit dignissim. Blandit cursus risus at ultrices mi tempus imperdiet. Aliquet porttitor lacus luctus accumsan tortor posuere. In cursus turpis massa tincidunt dui ut ornare lectus. Ac odio tempor orci dapibus ultrices in iaculis nunc. Augue ut lectus arcu bibendum at varius vel pharetra. Nunc eget lorem dolor sed viverra ipsum nunc aliquet bibendum. Viverra mauris in aliquam sem fringilla. Orci phasellus egestas tellus rutrum tellus pellentesque eu tincidunt tortor. Sed libero enim sed faucibus turpis in. Est lorem ipsum dolor sit. Mollis nunc sed id semper risus. Sed turpis tincidunt id aliquet risus.
                    <br />
                    Vitae ultricies leo integer malesuada nunc vel risus commodo viverra. Convallis aenean et tortor at risus viverra. Penatibus et magnis dis parturient montes nascetur ridiculus mus mauris. Sapien faucibus et molestie ac feugiat sed lectus. Id venenatis a condimentum vitae sapien pellentesque. Ultrices neque ornare aenean euismod. Neque vitae tempus quam pellentesque nec. Leo a diam sollicitudin tempor id eu. In tellus integer feugiat scelerisque varius. Vitae elementum curabitur vitae nunc sed velit dignissim. Enim sed faucibus turpis in eu mi bibendum neque. Mollis aliquam ut porttitor leo a. Nisi scelerisque eu ultrices vitae auctor. Massa tincidunt nunc pulvinar sapien et ligula ullamcorper. Placerat vestibulum lectus mauris ultrices.
                    <br />
                    <br />
                    Ultrices in iaculis nunc sed augue lacus. Natoque penatibus et magnis dis parturient montes nascetur ridiculus. Lacus vel facilisis volutpat est velit egestas dui id. Donec massa sapien faucibus et. Feugiat scelerisque varius morbi enim nunc faucibus. Interdum velit euismod in pellentesque. Imperdiet proin fermentum leo vel. Dolor sit amet consectetur adipiscing elit duis tristique. Felis donec et odio pellentesque. Mattis molestie a iaculis at erat pellentesque adipiscing commodo elit. Dui nunc mattis enim ut tellus elementum sagittis vitae et. Eleifend donec pretium vulputate sapien nec. Porttitor rhoncus dolor purus non enim. Et netus et malesuada fames ac turpis egestas maecenas. Interdum posuere lorem ipsum dolor sit amet consectetur adipiscing. Pellentesque elit eget gravida cum sociis natoque penatibus et magnis. Tortor dignissim convallis aenean et tortor at risus viverra adipiscing. Dolor purus non enim praesent. Magna etiam tempor orci eu lobortis elementum nibh tellus.
                </p>
                <img src="~/img/wallpaper.png" alt="Alternate Text" />
            </div>
        </div>
        <div class="d-flex flex-column">
            <div class="p-3 justify-content-center align-content-center d-flex">
                <p class="text-color-header">Bạn biết ai đó có thể trả lời câu hỏi này? Hãy chia sẻ đường dẫn câu hỏi đến họ qua:</p>
            </div>
            <div class="justify-content-center align-content-center d-flex px-3 gap-4"> 
                <img class="h-50" src="~/img/Facebook.png" alt="Facebook" />
                <img class="h-50" src="~/img/Pinterest.png" alt="Pinterest" />
                <img class="h-50" src="~/img/Reddit.png" alt="Reddit" />
                <img class="h-50" src="~/img/Telegram.png" alt="Telegram" />
                <img class="h-50" src="~/img/Github.png" alt="Github" />
            </div>
            <div class="d-flex justify-content-end mt-2">
                <img src="~/img/user.jpg" class="rounded-circle" alt="Avatar" width="30" height="30">
                <div class="newest-card-username mx-2">User1 hỏi 10 phút trước</div>
            </div>
            @if (isCmtAvaiable)
            {
                <div class="row mb-5">
                    <div class="col-6 d-flex justify-content-start fw-bold fs-4">
                        41 Câu trả lời
                    </div>
                    <button class="col-3 filter-forum d-flex justify-content-center align-items-center mx-4">
                        <div class="px-2">
                            Diễn đàn
                        </div>
                        <img src="/img/icon_filter_forum_50.png" alt="Filter" width="15" height="15">
                    </button>
                    <button class="col-3 filter-forum d-flex justify-content-center align-items-center mx-2">
                        <div class="px-2">
                            Bộ lọc
                        </div>
                        <img src="/img/icon_filter_sort_50.png" alt="Filter" width="20" height="20">
                    </button>
                </div>
                
            }
            <div>
                <p class="fs-5 text-color-logo">
                    Câu trả lời của bạn:
                </p>
            </div>
            <div class="border-2 rounded-3 border-main-color-header p-2 text-color-logo">
                <div class="d-flex col-lg-3 justify-content-evenly fs-5">
                    <button id="bold-btn" class="btn btn-outline-secondary m-2 px-2 py-1 rounded-3 hover-bold" style="min-width: 32px;">
                        <span>B</span>
                    </button>
                    <button id="italic-btn" class="btn btn-outline-secondary m-2 px-2 py-1 rounded-3 hover-italic" style="min-width: 32px;">
                        <span>I</span>
                    </button>
                    <button id="underline-btn" class="btn btn-outline-secondary m-2 px-2 py-1 rounded-3 hover-underline" style="min-width: 32px;">
                        <span>U</span>
                    </button>
                    <button id="undo-btn" class="btn btn-outline-secondary m-2 px-2 py-1 rounded-3" style="min-width: 32px;">
                        <span>↶</span>
                    </button>
                    <button id="redo-btn" class="btn btn-outline-secondary m-2 px-2 py-1 rounded-3" style="min-width: 32px;">
                        <span>↷</span>
                    </button>
                </div>
                <div class="border-top">
                    <textarea id="content-area" class="focus form-control m-2 p-2" style="min-height: 100px; width: calc(100% - 1rem); resize: vertical;" name="answer" placeholder="Viết câu trả lời tại đây..."></textarea>
                </div>
            </div>

            <div class="d-flex justify-content-end mt-2">
                <button class="m-2 px-3 py-2 bg-main-color-layout text-color-logo rounded-3">Đăng câu trả lời của bạn</button>
            </div>
        </div>
    </div>
</div>
<script>
        document.addEventListener('DOMContentLoaded', function () {
            const boldBtn = document.getElementById('bold-btn');
            const italicBtn = document.getElementById('italic-btn');
            const underlineBtn = document.getElementById('underline-btn');
            const undoBtn = document.getElementById('undo-btn');
            const redoBtn = document.getElementById('redo-btn');
            const contentArea = document.getElementById('content-area');

            let undoStack = [''];
            let redoStack = [];

            function applyStyle(style) {
                const start = contentArea.selectionStart;
                const end = contentArea.selectionEnd;
                const selectedText = contentArea.value.substring(start, end);
                let replacement = '';

                switch (style) {
                    case 'bold':
                        replacement = `<strong>${selectedText}</strong>`;
                        break;
                    case 'italic':
                        replacement = `<em>${selectedText}</em>`;
                        break;
                    case 'underline':
                        replacement = `<u>${selectedText}</u>`;
                        break;
                }

                contentArea.value = contentArea.value.substring(0, start) + replacement + contentArea.value.substring(end);

                this.classList.toggle('active');
                saveState();
            }

            function saveState() {
                undoStack.push(contentArea.value);
                redoStack = [];
            }

            function updateButtonStates() {
                const selection = window.getSelection();
                if (selection.rangeCount > 0) {
                    const range = selection.getRangeAt(0);
                    const span = document.createElement('span');
                    range.surroundContents(span);

                    boldBtn.classList.toggle('active', span.querySelector('strong'));
                    italicBtn.classList.toggle('active', span.querySelector('em'));
                    underlineBtn.classList.toggle('active', span.querySelector('u'));

                    range.extractContents();
                    range.insertNode(span.firstChild);
                }
            }

            function debounce(func, delay) {
                let timeoutId;
                return function () {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => func.apply(context, args), delay);
                };
            }

            const debouncedUpdateButtonStates = debounce(updateButtonStates, 250);

            boldBtn.addEventListener('click', function () { applyStyle.call(this, 'bold'); });
            italicBtn.addEventListener('click', function () { applyStyle.call(this, 'italic'); });
            underlineBtn.addEventListener('click', function () { applyStyle.call(this, 'underline'); });

            undoBtn.addEventListener('click', function () {
                if (undoStack.length > 1) {
                    redoStack.push(undoStack.pop());
                    contentArea.value = undoStack[undoStack.length - 1];
                }
            });

            redoBtn.addEventListener('click', function () {
                if (redoStack.length > 0) {
                    undoStack.push(redoStack.pop());
                    contentArea.value = undoStack[undoStack.length - 1];
                }
            });

            contentArea.addEventListener('input', saveState);
            contentArea.addEventListener('mouseup', debouncedUpdateButtonStates);
            contentArea.addEventListener('keyup', debouncedUpdateButtonStates);
        });
</script>
